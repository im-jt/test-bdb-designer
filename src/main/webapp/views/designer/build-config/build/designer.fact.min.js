/*! BDB Dashboard Designer V10.0.0 (2025-08-14 11:38:13) 
 Copyright 2015-2024 BDB (BizViz Technologies Pvt Ltd). All Rights Reserved */
angular.module("designer").factory("DesignerFactory",["$rootScope",function(e){var c={xhrCounter:0,xhrInProgress:!1,isDatasetEnabled:!1,isScriptEnabled:!1,dbCreationInProgress:!1,wsObj:{},dashboards:[],dashboardTabs:[],selectedDashboardContainer:"",selectedDashboard:"",objectListChange:0,usersPortalPreference:"",rawComponentJSONlist:{},propertyJson:{},propertyJsonList:{},propertyData:{},compMetaData:{},selectedComponent:{},selectedComponentId:"",selectedVariableDefaultValue:"",listOfSelectedComponents:[],userDataSourceList:{web:"",pa:"",ds:"",datasheet:""},objectsList:[],historyProperties:{},dashActionConfig:{},calcFieldConfig:{},publishDbConfig:{},connectorConfig:{},modelPopupStatus:{},globalThemeDbConfig:{},prepForBroadcast:function(){e.$broadcast("getJsonFromOpenDashoardAndDrawComponent")},createHistoryProperties:function(e){c.historyProperties[e]={historyStack:[],historyActiveStack:[],compHistory:[],historyStackPointer:-1,skipHistoryRegister:!1,historyLength:100}},currentHistoryProperties:function(e){return null==e?c.historyProperties[c.selectedDashboard.id]:c.historyProperties[c.selectedDashboard.id]=e},removeHistoryProperties:function(e){c.historyProperties[e]=void 0},selectedDashboardHistoryProperties:function(e,t){return null==t?c.historyProperties[c.selectedDashboard.id][e]:c.historyProperties[c.selectedDashboard.id][e]=t},isArray:function(e){var t=!1;return t=e?"[object Array]"===Object.prototype.toString.call(e):t},isArrayContains:function(e,t){var a=!1;return a=c.isArray(e)?-1!=e.indexOf(t):a},notifyObjectListChange:function(){c.objectListChange++,c.refreshAllObjectList(),c.updateDashboardStatus(1)},notifyConnectionListChange:function(){c.refreshAllObjectList()},getSelectedDashboardId:function(){return c.selectedDashboard.id},refreshAllObjectList:function(){var a=!1;c.selectedDashboard.objectsList=[],angular.forEach(c.selectedDashboard.json.Dashboard[c.layoutType].Object,function(e){e&&"object"==typeof e&&c.selectedDashboard.objectsList.push({name:e.objectName,id:e.objectID,refId:e.referenceID})}),angular.forEach(c.selectedDashboard.json.Dashboard.DataProviders.DataURL,function(e){e&&"object"==typeof e&&c.selectedDashboard.objectsList.push({name:e.connectionName,id:e.id,refId:e.id})}),c.dashVarMap[c.getSelectedDashboardId()]=[],c.dashVarMap[c.getSelectedDashboardId()].push("sdk"),c.dashVarMap[c.getSelectedDashboardId()].push("changedItem"),angular.forEach(c.selectedDashboard.objectsList,function(e){var t=e.name+" >> '"+e.refId+"'";c.dashVarMap[c.getSelectedDashboardId()].push(t),e.name===c.scriptFor&&(a=!0)}),a||(c.scriptFor="")},refreshDataUrlAvailableDataSet:function(){try{for(var t=c.selectedDashboard.json.Dashboard.DataProviders.selectedConnection.AssociatedDataSet,a=0;a<t.length;a++)angular.forEach(c.selectedDashboard.json.Dashboard.AbsoluteLayout.Object,function(e){e&&"object"==typeof e&&e.referenceID==t[a].component&&(e[e.subElement].DataSet.Fields=[])})}catch(e){}},removeChangedFieldFromAvailableDataSet:function(o,n){try{for(var t=c.selectedDashboard.json.Dashboard.DataProviders.selectedConnection.AssociatedDataSet,a=0;a<t.length;a++)angular.forEach(c.selectedDashboard.json.Dashboard.AbsoluteLayout.Object,function(e){var r;e&&"object"==typeof e&&e.referenceID==t[a].component&&(r=e[e.subElement].DataSet.Fields,angular.forEach(r,function(e){var t=o.map(function(e){return e.name}).indexOf(e.Name),a=n.map(function(e){return e.name}).indexOf(e.Name);-1==t&&-1==a&&(t=r.indexOf(e),r.splice(t,1),c.removeChangedFieldFromAvailableDataSet(o,n))}))})}catch(e){}},removeFromDataUrlAvailableDataSet:function(e){e=c.selectedDatasource.AssociatedDataSet.indexOf(e);c.selectedDatasource.AssociatedDataSet.splice(e,1)},removeDataSetFromComponentObjects:function(e){e=DesignerUtil.prototype.findInArray(c.selectedDashboard.json.Dashboard.DataProviders.DataURL,"id",e);if(e){var t=e.AssociatedDataSet;if(t)for(var a=0;a<t.length;a++)t[a].component.DataSet=""}},removeFieldFromDataSet:function(e,t){for(var a=c.selectedDashboard.json.Dashboard.AbsoluteLayout.Object,r=0;r<a.length;r++){var o=a[r].subElement;if(null!=a[r][o].DataSet)for(var n,s=0;s<a[r][o].DataSet.Fields.length;s++)a[r][o].DataSet.Fields[s].Name==e&&a[r][o].DataSet.dataSource===t&&(n=a[r][o].DataSet.Fields.indexOf(a[r][o].DataSet.Fields[s]),a[r][o].DataSet.Fields.splice(n,1))}},removeDatafromOfflineData:function(e){for(var t=c.selectedDashboard.json.Dashboard.OffLineData.Data,a=0;a<t.length;a++)if(t[a].id==e){var r=c.selectedDashboard.json.Dashboard.OffLineData.Data.indexOf(t[a]);c.selectedDashboard.json.Dashboard.OffLineData.Data.splice(r,1);break}},removeDatasetExpressions:function(e){for(var t,a=angular.copy(c.selectedDashboard.json.Dashboard.DatasetExpressions.DatasetExpression),r=0;r<a.length;r++)a[r].dataSource==e&&(t=c.selectedDashboard.json.Dashboard.DatasetExpressions.DatasetExpression.indexOf(a[r]),c.selectedDashboard.json.Dashboard.DatasetExpressions.DatasetExpression.splice(t,1))},getUniqueComponentID:function(){var e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)});return global.componetIDPrefix+e},getUniqueReference:function(e){for(var t=e+(+c.getSelectedDashboardsComponentCount()+1),a=c.checkIDUsed(c.selectedDashboard.json.Dashboard.AbsoluteLayout.Object,"referenceID",t);a;)t=e+"_"+randomChar(2),a=c.checkIDUsed(c.selectedDashboard.json.Dashboard.AbsoluteLayout.Object,"referenceID",t);return t},checkIDUsed:function(e,t,a){if(e)for(var r=0;r<e.length;r++)if(e[r]&&e[r][t]==a)return!0;return!1},getSelectedDashboardsComponentCount:function(){return c.selectedDashboard.json.Dashboard.AbsoluteLayout.Object.length},getSelectedDashboardsConnectionCount:function(){return c.selectedDashboard.json.Dashboard.DataProviders.DataURL.length},getUniqueConnectionID:function(e){for(var t=e+"_"+(+c.getSelectedDashboardsConnectionCount()+1),a=c.checkIDUsed(c.selectedDashboard.json.Dashboard.DataProviders.DataURL,"id",t);a;)t=e+"_"+randomChar(2),a=c.checkIDUsed(c.selectedDashboard.json.Dashboard.AbsoluteLayout.Object,"objectID",t);return t},getfieldSetFromConnection:function(t){var e=$.grep(c.selectedDashboard.json.Dashboard.DataProviders.DataURL,function(e){if(e.id==t)return e});if(null!=e[0])return e[0].FieldSet},getCalculatedFieldSetFromConnection:function(t){var e=$.grep(c.selectedDashboard.json.Dashboard.DataProviders.DataURL,function(e){if(e.id==t)return e});if(null!=e[0])return e[0].calculatedFieldList},getDatasetFromComponent:function(t){var e=$.grep(selectedDashboard.json.Dashboard.AbsoluteLayout.Object,function(e){if(e.id==t)return e});if(null!=e[0])return e[0].Chart.Dataset},updateDashboardStatus:function(e){null!=c.selectedDashboard&&(c.selectedDashboard.json.changeStatus=e)},replaceSpecialCharWithUnderscore:function(t){try{return t.replace(/[\/\\\[\]'"*=:<>?|{}-]/g,"_")}catch(e){return t}},replaceCFSpecialCharWithUnderscore:function(t){try{return t.replace(/[\/\\\[\]'"*=:<>?|{}-~`!@#$%^&()+;,.]/g,"_")}catch(e){return t}},selectedConnection:"",selectedDataURL:"",selectedOffLineData:"",selectedDataSource:"",selectedQueryService:"",dataSourceQueryMap:[],selectedWorkspaceIdForSave:"",wsObjForSave:{},dbInsideWs:[],newWorkspaceName:"Untitled Workspace",dashboardSpaceMsg:"No dashboard found !",workspaceSpaceMsg:"No Workspace found !",dashboardSpaceHeader:"Dashboards",workSpaceHeader:"Workspaces",bgGridSize:10,databackdrop:"static",userPreference:{compSelcOpts:{thickness:1,color:"#999999"},defaultSettings:{blockNotificaton:!0,dashboardBackgroundColor:"#FFFFFF",dashboardBorderColor:"#08AEA8",dashboardBorderThickness:1,dashboardHeight:566,dashboardWidth:929,fixedDashboardDimensions:!1,gridLinesColor:"#CCCCCC",hideShadow:!0,language:"en-US",notifyOnSuccess:!0,showDashboardBorder:!0,syncComponentProperty:!1,showSettingsButton:!0},display:!0,showGridLines:!1,snapToGrid:{enable:"true",size:1}},layoutType:"AbsoluteLayout",newDir:!1};return c}]),angular.module("designer").factory("ServiceFactory",["$http","$timeout","DesignerFactory","notify",function(a,e,c,o){var r={},n={};return r.getJsonFileData=function(e,t,o,n){a.get(e,{cache:!0}).then(function(e){t&&"function"==typeof t&&t(e.data,o)},function(e,t,a,r){n&&"function"==typeof n&&n(t,o)})},r.getAuthInfo=function(){return c.AUTH_INFO},r.showLoader=function(e){$.unblockUI(),$.blockUI({message:'<div class="la-ball-clip-rotate la-dark la-lg"><div></div></div>',timeout:e&&void 0!==e.timeout?e.timeout:6e4,css:{zIndex:9999999999,border:"none",top:"25%",background:"transparent"},overlayCSS:{backgroundColor:"#2dc3e8",opacity:.2,cursor:"wait",zIndex:9999999999}})},r.hideLoader=function(){$.unblockUI()},r.AUTH_INFO={get:function(e){switch(e){case"authType":return c.AUTH_INFO.authType;case"token":return c.AUTH_INFO.authToken;case"spacekey":return c.AUTH_INFO.user.spaceKey;case"userID":return c.AUTH_INFO.user.id;case"preferenceObject":return c.AUTH_INFO.preference.themeID;case"rootFolders":return c.AUTH_INFO.trees;case"user":return c.AUTH_INFO.user;case"preferenceID":return;case"lite":return c.AUTH_INFO.user.lite;default:return}}},r.getCommonElement=function(){var e=[],t=!0;if(0<arguments.length)for(var a=0;a<arguments[0].length;a++){for(var r=1;r<arguments.length;r++)t=-1!=arguments[r].indexOf(arguments[0][a]);t&&e.push(arguments[0][a])}return e},r.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},r.isArrayContains=function(e,t){return-1!=e.indexOf(t)},r.showNotification=function(e,t,a){var r=null;return a="alert-warning"==t||"alert-danger"==t?6e4:a,!("alert-success"==t&&c.userPreference&&!c.userPreference.defaultSettings.notifyOnSuccess||"alert-info"==t&&c.userPreference&&c.userPreference.defaultSettings.blockNotificaton)&&(n[e]&&(n[e].close(),n[e]=null),void(e&&(r=o({message:e,classes:t,duration:a}),n[e]=r,0<a)&&setTimeout(function(){r.close(),n[e]=null},a)))},r.closeAllNotifications=function(){o.closeAll()},r.setUpHeaders=function(){return{"Content-Type":"application/x-www-form-urlencoded",authtoken:r.AUTH_INFO.get("token"),spacekey:r.AUTH_INFO.get("spacekey"),userid:r.AUTH_INFO.get("userID")}},r.setupFormData=function(e){return e.token=r.AUTH_INFO.get("token"),e.spacekey=r.AUTH_INFO.get("spacekey"),e.userid=r.AUTH_INFO.get("userID"),e.from=0,e.rows=9999,e},r.postRequestToServer=function(e,t,a,o,n){c.xhrInProgress=!0,c.xhrCounter++,$("#web-conn-loader").show();var s=setTimeout(function(){$(".loader").hide(),r.showNotification("Server is taking too much time","alert-info",3e3)},6e4);BIZVIZ.SDK.secureRequest(e,a,function(e,t,a,r){o(e,t,a,r),c.xhrCounter--,c.xhrCounter||$("#web-conn-loader").hide(),clearTimeout(s),c.xhrInProgress=!1},function(e,t,a,r){$("#web-conn-loader").hide(),0==t&&(clearTimeout(s),$("#sessionWarning").modal("show")),n&&"function"==typeof n&&n(e,t,a,r)})},r.isValidHexColorString=function(e){return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(e)},r.correctObjectFormat=function(e){return"boolean"==typeof e||"object"==typeof e?e:isNaN(e)?"true"===e||"false"!==e&&e:parseFloat(e)},r.getValidBoolean=function(e){return"string"==typeof e?"true"==e.toLowerCase():"boolean"==typeof e?e:!!e},r}]).factory("XLSXReaderService",["$q","$rootScope",function(o,n){function e(e){angular.extend(this,e)}return e.readFile=function(e,t,a){var r=o.defer();return XLSXReader(e,t,a,function(e){n.$apply(function(){r.resolve(e)})}),r.promise},e}]);
//# sourceMappingURL=designer.fact.min.js.map