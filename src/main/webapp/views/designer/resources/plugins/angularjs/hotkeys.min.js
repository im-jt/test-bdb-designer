!function(){"use strict";angular.module("cfp.hotkeys",[]).provider("hotkeys",function(){this.includeCheatSheet=!0,this.templateTitle="Keyboard Shortcuts:",this.template='<div class="cfp-hotkeys-container fade" ng-class="{in: helpVisible}" style="display: none;"><div class="cfp-hotkeys"><h4 class="cfp-hotkeys-title">{{ title }}</h4><table><tbody><tr ng-repeat="hotkey in hotkeys | filter:{ description: \'!$$undefined$$\' }"><td class="cfp-hotkeys-keys"><span ng-repeat="key in hotkey.format() track by $index" class="cfp-hotkeys-key">{{ key }}</span></td><td class="cfp-hotkeys-text">{{ hotkey.description }}</td></tr></tbody></table><div class="cfp-hotkeys-close" ng-click="toggleCheatSheet()">×</div></div></div>',this.cheatSheetHotkey="?",this.cheatSheetDescription="Show / hide this help menu",this.$get=["$rootElement","$rootScope","$compile","$window","$document",function(e,t,n,o,i){function r(e){var t={command:"⌘",shift:"⇧",left:"←",right:"→",up:"↑",down:"↓","return":"↩",backspace:"⌫"};e=e.split("+");for(var n=0;n<e.length;n++)"mod"===e[n]&&(o.navigator&&o.navigator.platform.indexOf("Mac")>=0?e[n]="command":e[n]="ctrl"),e[n]=t[e[n]]||e[n];return e.join(" + ")}function a(e,t,n,o,i,r){this.combo=e instanceof Array?e:[e],this.description=t,this.callback=n,this.action=o,this.allowIn=i,this.persistent=r}function s(){for(var e=d.hotkeys.length;e--;){var t=d.hotkeys[e];t&&!t.persistent&&h(t)}}function c(){d.helpVisible=!d.helpVisible,d.helpVisible?(g=u("esc"),h("esc"),l("esc",g.description,c)):(h("esc"),g!==!1&&l(g))}function l(e,t,n,o,i,r){var s,c=["INPUT","SELECT","TEXTAREA"],l=Object.prototype.toString.call(e);if("[object Object]"===l&&(t=e.description,n=e.callback,o=e.action,r=e.persistent,i=e.allowIn,e=e.combo),t instanceof Function?(o=n,n=t,t="$$undefined$$"):angular.isUndefined(t)&&(t="$$undefined$$"),void 0===r&&(r=!0),"function"==typeof n){s=n,i instanceof Array||(i=[]);for(var h,u=0;u<i.length;u++)i[u]=i[u].toUpperCase(),h=c.indexOf(i[u]),-1!==h&&c.splice(h,1);n=function(e){var t=!0,n=e.target||e.srcElement,o=n.nodeName.toUpperCase();if((" "+n.className+" ").indexOf(" mousetrap ")>-1)t=!0;else for(var i=0;i<c.length;i++)if(c[i]===o){t=!1;break}t&&p(s.apply(this,arguments))}}"string"==typeof o?Mousetrap.bind(e,p(n),o):Mousetrap.bind(e,p(n));var f=new a(e,t,n,o,i,r);return d.hotkeys.push(f),f}function h(e){var t=e instanceof a?e.combo:e;if(Mousetrap.unbind(t),angular.isArray(t)){for(var n=!0,o=t.length;o--;)n=h(t[o])&&n;return n}var i=d.hotkeys.indexOf(u(t));return i>-1?(d.hotkeys[i].combo.length>1?d.hotkeys[i].combo.splice(d.hotkeys[i].combo.indexOf(t),1):d.hotkeys.splice(i,1),!0):!1}function u(e){for(var t,n=0;n<d.hotkeys.length;n++)if(t=d.hotkeys[n],t.combo.indexOf(e)>-1)return t;return!1}function f(e){return e.$id in y||(y[e.$id]=[],e.$on("$destroy",function(){for(var t=y[e.$id].length;t--;)h(y[e.$id][t]),delete y[e.$id][t]})),{add:function(t){var n;return n=arguments.length>1?l.apply(this,arguments):l(t),y[e.$id].push(n),this}}}function p(e){return function(n,o){if(e instanceof Array){var i=e[0],r=e[1];e=function(e){r.scope.$eval(i)}}t.$apply(function(){e(n,u(o))})}}Mousetrap.stopCallback=function(e,t){return(" "+t.className+" ").indexOf(" mousetrap ")>-1?!1:t.contentEditable&&"true"==t.contentEditable},a.prototype.format=function(){for(var e=this.combo[0],t=e.split(/[\s]/),n=0;n<t.length;n++)t[n]=r(t[n]);return t};var d=t.$new();d.hotkeys=[],d.helpVisible=!1,d.title=this.templateTitle,d.toggleCheatSheet=c;var y=[];if(t.$on("$routeChangeSuccess",function(e,t){s(),t&&t.hotkeys&&angular.forEach(t.hotkeys,function(e){var n=e[2];("string"==typeof n||n instanceof String)&&(e[2]=[n,t]),e[5]=!1,l.apply(this,e)})}),this.includeCheatSheet){var m=i[0],k=e[0],v=angular.element(this.template);l(this.cheatSheetHotkey,this.cheatSheetDescription,c),(k===m||k===m.documentElement)&&(k=m.body),angular.element(k).append(n(v)(d))}var g=!1,b={add:l,del:h,get:u,bindTo:f,template:this.template,toggleCheatSheet:c,includeCheatSheet:this.includeCheatSheet,cheatSheetHotkey:this.cheatSheetHotkey,cheatSheetDescription:this.cheatSheetDescription,purgeHotkeys:s,templateTitle:this.templateTitle};return b}]}).directive("hotkey",["hotkeys",function(e){return{restrict:"A",link:function(t,n,o){var i,r;angular.forEach(t.$eval(o.hotkey),function(t,n){r="string"==typeof o.hotkeyAllowIn?o.hotkeyAllowIn.split(/[\s,]+/):[],i=n,e.add({combo:n,description:o.hotkeyDescription,callback:t,action:o.hotkeyAction,allowIn:r})}),n.bind("$destroy",function(){e.del(i)})}}}]).run(["hotkeys",function(e){}])}(),function(e,t,n){function o(e,t,n){return e.addEventListener?void e.addEventListener(t,n,!1):void e.attachEvent("on"+t,n)}function i(e){if("keypress"==e.type){var t=String.fromCharCode(e.which);return e.shiftKey||(t=t.toLowerCase()),t}return E[e.which]?E[e.which]:T[e.which]?T[e.which]:String.fromCharCode(e.which).toLowerCase()}function r(e,t){return e.sort().join(",")===t.sort().join(",")}function a(e){e=e||{};var t,n=!1;for(t in N)e[t]?n=!0:N[t]=0;n||(P=!1)}function s(e,t,n,o,i,a){var s,c,l=[],h=n.type;if(!O[e])return[];for("keyup"==h&&d(e)&&(t=[e]),s=0;s<O[e].length;++s)if(c=O[e][s],(o||!c.seq||N[c.seq]==c.level)&&h==c.action&&("keypress"==h&&!n.metaKey&&!n.ctrlKey||r(t,c.modifiers))){var u=!o&&c.combo==i,f=o&&c.seq==o&&c.level==a;(u||f)&&O[e].splice(s,1),l.push(c)}return l}function c(e){var t=[];return e.shiftKey&&t.push("shift"),e.altKey&&t.push("alt"),e.ctrlKey&&t.push("ctrl"),e.metaKey&&t.push("meta"),t}function l(e){return e.preventDefault?void e.preventDefault():void(e.returnValue=!1)}function h(e){return e.stopPropagation?void e.stopPropagation():void(e.cancelBubble=!0)}function u(e,t,n,o){I.stopCallback(t,t.target||t.srcElement,n,o)||e(t,n)===!1&&(l(t),h(t))}function f(e,t,n){var o,i=s(e,t,n),r={},c=0,l=!1;for(o=0;o<i.length;++o)i[o].seq&&(c=Math.max(c,i[o].level));for(o=0;o<i.length;++o)if(i[o].seq){if(i[o].level!=c)continue;l=!0,r[i[o].seq]=1,u(i[o].callback,n,i[o].combo,i[o].seq)}else l||u(i[o].callback,n,i[o].combo);var h="keypress"==n.type&&M;n.type!=P||d(e)||h||a(r),M=l&&"keydown"==n.type}function p(e){"number"!=typeof e.which&&(e.which=e.keyCode);var t=i(e);if(t)return"keyup"==e.type&&q===t?void(q=!1):void I.handleKey(t,c(e),e)}function d(e){return"shift"==e||"ctrl"==e||"alt"==e||"meta"==e}function y(){clearTimeout(C),C=setTimeout(a,1e3)}function m(){if(!S){S={};for(var e in E)e>95&&112>e||E.hasOwnProperty(e)&&(S[E[e]]=e)}return S}function k(e,t,n){return n||(n=m()[e]?"keydown":"keypress"),"keypress"==n&&t.length&&(n="keydown"),n}function v(e,t,n,o){function r(t){return function(){P=t,++N[e],y()}}function s(t){u(n,t,e),"keyup"!==o&&(q=i(t)),setTimeout(a,10)}N[e]=0;for(var c=0;c<t.length;++c){var l=c+1===t.length,h=l?s:r(o||b(t[c+1]).action);$(t[c],h,o,e,c)}}function g(e){return"+"===e?["+"]:e.split("+")}function b(e,t){var n,o,i,r=[];for(n=g(e),i=0;i<n.length;++i)o=n[i],x[o]&&(o=x[o]),t&&"keypress"!=t&&A[o]&&(o=A[o],r.push("shift")),d(o)&&r.push(o);return t=k(o,r,t),{key:o,modifiers:r,action:t}}function $(e,t,n,o,i){K[e+":"+n]=t,e=e.replace(/\s+/g," ");var r,a=e.split(" ");return a.length>1?void v(e,a,t,n):(r=b(e,n),O[r.key]=O[r.key]||[],s(r.key,r.modifiers,{type:r.action},o,e,i),void O[r.key][o?"unshift":"push"]({callback:t,modifiers:r.modifiers,action:r.action,seq:o,level:i,combo:e}))}function w(e,t,n){for(var o=0;o<e.length;++o)$(e[o],t,n)}for(var S,C,E={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},T={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},A={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},x={option:"alt",command:"meta","return":"enter",escape:"esc",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},O={},K={},N={},q=!1,M=!1,P=!1,D=1;20>D;++D)E[111+D]="f"+D;for(D=0;9>=D;++D)E[D+96]=D;o(t,"keypress",p),o(t,"keydown",p),o(t,"keyup",p);var I={bind:function(e,t,n){return e=e instanceof Array?e:[e],w(e,t,n),this},unbind:function(e,t){return I.bind(e,function(){},t)},trigger:function(e,t){return K[e+":"+t]&&K[e+":"+t]({},e),this},reset:function(){return O={},K={},this},stopCallback:function(e,t){return(" "+t.className+" ").indexOf(" mousetrap ")>-1?!1:"INPUT"==t.tagName||"SELECT"==t.tagName||"TEXTAREA"==t.tagName||t.isContentEditable},handleKey:f};e.Mousetrap=I,"function"==typeof define&&define.amd&&define(I)}(window,document);